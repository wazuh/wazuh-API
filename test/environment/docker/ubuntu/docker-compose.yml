version: '3.7'

services:
  wazuh-master:
    build:
      context: ./wazuh-manager
      args:
        wazuhbranch: "3.10"
        wazuhapibranch: "3.10"
    image: wazuh-manager-ubuntu:3.10
    networks:
      wazuh_network:
        ipv4_address: 172.40.1.1
    ports:
      - "2222:22"
      - "55000:55000"
    entrypoint:
      - /scripts/entrypoint.sh
      - wazuh-master
      - master-node
      - master
  wazuh-worker1:
    build:
      context: ./wazuh-manager
      args:
        wazuhbranch: "3.10"
        wazuhapibranch: "3.10"
    image: wazuh-manager-ubuntu:3.10
    networks:
      wazuh_network:
        ipv4_address: 172.40.1.2
    depends_on:
      - wazuh-master
    entrypoint:
      - /scripts/entrypoint.sh
      - wazuh-master
      - worker-1
      - worker
  wazuh-worker2:
    build:
      context: ./wazuh-manager
      args:
        wazuhbranch: "3.10"
        wazuhapibranch: "3.10"
    image: wazuh-manager-ubuntu:3.10
    networks:
      wazuh_network:
        ipv4_address: 172.40.1.3
    depends_on:
      - wazuh-master
    entrypoint:
      - /scripts/entrypoint.sh
      - wazuh-master
      - worker-2
      - worker
  wazuh-agent1:
    build:
      context: ./wazuh-agent
    image: wazuh-agent-ubuntu:3.10
    networks:
      wazuh_network:
        ipv4_address: 172.40.2.1
    entrypoint: 
      - /scripts/entrypoint.sh 
      - wazuh-master
      - wazuh-master
    depends_on:
      - wazuh-master
  wazuh-agent2:
    build:
      context: ./wazuh-agent
    image: wazuh-agent-ubuntu:3.10
    networks:
      wazuh_network:
        ipv4_address: 172.40.2.2
    entrypoint: 
      - /scripts/entrypoint.sh
      - wazuh-master
      - wazuh-worker1
    depends_on:
      - wazuh-master
      - wazuh-worker1
      - wazuh-agent1
  wazuh-agent3:
    build:
      context: ./wazuh-agent-outdated
    image: wazuh-agent-ubuntu:3.5
    networks:
      wazuh_network:
        ipv4_address: 172.40.2.3
    entrypoint:
      - /scripts/entrypoint.sh
      - wazuh-master
      - wazuh-worker2
    depends_on:
      - wazuh-master
      - wazuh-agent1
      - wazuh-agent2

networks:
  wazuh_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.40.0.0/16
